#!/bin/bash
set -x
unset environment runlist loglevel
if grep -q root /etc/group; then
  addgroup -S -g 0 root
  adduser root root
fi
if test -n "${UPDATE_CA}"; then
  updateca="$(which update-ca-certificates)"
  test -x "${updateca}" && "${updateca}"
fi
options="--config=/etc/chef/client.rb $@"
test -n "${CHEF_LOGLEVEL}" && options="${options} --log_level=${CHEF_LOGLEVEL}"
test -n "${CHEF_ENVIRONMENT}" && options="${options} --environment=${CHEF_ENVIRONMENT}"
test -n "${CHEF_RUNLIST}" && options="${options} --runlist=${CHEF_RUNLIST}"
exec chef-client ${options}
